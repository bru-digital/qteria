# [EPIC-08] Reporting & Export

**Type**: Epic
**Journey Step**: Step 5 - Forward Clean Documents
**Priority**: P1 (Important for Launch)

---

## Epic Overview

Generate PDF validation reports that Project Handlers can download and forward to Certification Person. Report includes pass/fail summary, evidence references, and timestamp. This is **Journey Step 5** - clean handoff with confidence.

**User Value**: Project Handlers export professional validation reports to prove documents were pre-checked, reducing Certification Person clarification rounds.

---

## Success Criteria

- [ ] Can generate PDF report from assessment results
- [ ] Report includes all criteria results with evidence
- [ ] Report shows assessment metadata (workflow name, date, user)
- [ ] Can download report
- [ ] Can create shareable public link (optional)
- [ ] Report generation <10 seconds

---

## Stories in This Epic

### STORY-034: Generate PDF Report API [P1, 2 days]

Implement `POST /v1/assessments/:id/reports` endpoint that generates PDF report (using ReportLab or WeasyPrint) with assessment results, evidence, and metadata. Returns report_id.

**RICE**: R:80 × I:2 × C:80% ÷ E:2 = **64**

### STORY-035: Download Report API [P1, 1 day]

Implement `GET /v1/reports/:id/download` endpoint that streams generated PDF. Store reports in Vercel Blob (same as documents).

**RICE**: R:80 × I:1 × C:100% ÷ E:1 = **80**

### STORY-036: Shareable Public Report Links [P2, 1 day]

Implement `POST /v1/reports/:id/share` endpoint that creates public token (expires in 7 days). Public URL: `/public/reports/:token` (no auth required).

**RICE**: R:40 × I:1 × C:60% ÷ E:1 = **24**

---

## Total Estimated Effort

**4 person-days** (1 week for solo founder)

**Breakdown**:

- Backend: 3 days (PDF generation, download, public links)
- Frontend: 0.5 days (download button, share UI)
- Testing: 0.5 days (integration tests)

---

## Dependencies

**Blocks**: Nothing (optional polish)

**Blocked By**:

- STORY-027: Results display (needs results data to generate report)

---

## Technical Approach

**Tech Stack**:

- Backend: FastAPI + ReportLab or WeasyPrint (Python PDF generation)
- Storage: Vercel Blob (store generated reports)
- Frontend: Next.js (download button)

**Report Content**:

```
┌─────────────────────────────────────────┐
│ Qteria Validation Report                │
│                                         │
│ Workflow: Medical Device - Class II    │
│ Completed: 2026-01-15 14:32 UTC        │
│ Assessed by: handler@tuvsud.com        │
│                                         │
│ Overall Status: 3/5 Criteria Passed    │
│                                         │
│ ✅ Criteria 1: Signatures present      │
│    Status: PASS                         │
│    Confidence: High                     │
│    Evidence: All documents signed       │
│                                         │
│ ❌ Criteria 2: Test summary missing    │
│    Status: FAIL                         │
│    Confidence: High                     │
│    Evidence: test-report.pdf, page 8   │
│    section 3.2 missing pass/fail table │
│                                         │
│ ... (3 more criteria)                  │
│                                         │
│ Generated by Qteria on 2026-01-15      │
└─────────────────────────────────────────┘
```

**Report Generation Flow**:

1. User clicks "Export Report" on results page
2. Frontend calls `POST /v1/assessments/:id/reports`
3. Backend generates PDF (ReportLab, 5-10 seconds)
4. Backend uploads PDF to Vercel Blob
5. Backend returns report_id
6. Frontend polls `GET /v1/reports/:id` until ready
7. Frontend shows "Download" button
8. User clicks "Download" → `GET /v1/reports/:id/download` streams PDF

**Public Sharing** (STORY-036 - optional):

- User clicks "Share Report"
- Backend creates token (UUID), expires in 7 days
- Public URL: `https://qteria.com/public/reports/abc123xyz`
- Anyone with link can view report (no auth required)
- Use case: Forward link to Certification Person instead of PDF attachment

**Reference**: `product-guidelines/00-user-journey.md` (Step 5)

---

## Success Metrics

**User Experience**:

- Reports generated per assessment: >50%
- Report generation time: <10 seconds
- Download success rate: >98%

**Technical**:

- PDF file size: <1MB (keep small for email attachments)
- Report storage costs: <$1/month (expire old reports after 90 days)

---

## Definition of Done

- [ ] PDF generation working (ReportLab/WeasyPrint)
- [ ] Report includes all assessment results + evidence
- [ ] Download API streams PDF
- [ ] Public sharing (optional) creates time-limited links
- [ ] Report auto-expires after 90 days (lifecycle policy)
- [ ] E2E test: Generate report → Download → View PDF
- [ ] Code coverage >70% backend
- [ ] Code reviewed and merged to main

---

## Risks & Mitigations

**Risk**: PDF generation slow (>10 seconds)

- **Mitigation**: Async generation (Celery job), cache generated reports

**Risk**: PDF file size too large (>5MB)

- **Mitigation**: Compress images, use simple formatting

**Risk**: Public links exploited (spam, abuse)

- **Mitigation**: Time-limited expiration (7 days), rate limiting on public endpoint

---

## Testing Requirements

**Integration Tests** (70% coverage):

- [ ] POST /v1/assessments/:id/reports generates PDF
- [ ] GET /v1/reports/:id/download streams PDF
- [ ] POST /v1/reports/:id/share creates public link
- [ ] GET /public/reports/:token returns report (no auth)
- [ ] Expired token returns 404

**E2E Tests**:

- [ ] Complete reporting flow (Journey Step 5)
- [ ] Generate → Download → View PDF in browser

---

## Next Epic

After completing this epic, proceed to **EPIC-09: Performance Optimization** to accelerate assessments and improve UX.
